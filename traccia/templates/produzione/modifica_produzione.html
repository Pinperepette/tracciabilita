{% extends 'base.html' %}

{% block title %}Modifica Produzione{% endblock %}

{% block content %}
    <h2 class="my-4">Modifica Produzione</h2>

    <form action="{{ url_for('produzione.modifica_produzione', id=produzione['id']) }}" method="POST">
        <div class="form-group">
            <label for="data_produzione">Data di Produzione</label>
            <input type="date" class="form-control" id="data_produzione" name="data_produzione" value="{{ produzione['data_produzione'] }}" required>
        </div>
        <div class="form-group">
            <label for="lotto">Lotto</label>
            <input type="text" class="form-control" id="lotto" name="lotto" value="{{ produzione['lotto'] }}" required>
        </div>
        <div class="form-group">
            <label for="prodotto_id">Prodotto</label>
            <select class="form-control" id="prodotto_id" name="prodotto_id" required>
                {% for prodotto in prodotti %}
                <option value="{{ prodotto.id }}" {% if produzione['prodotto_id'] == prodotto.id %}selected{% endif %}>{{ prodotto.nome }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="scadenza">Scadenza</label>
            <input type="date" class="form-control" id="scadenza" name="scadenza" value="{{ produzione['scadenza'] }}">
        </div>
        <div class="form-check">
            <input type="checkbox" class="form-check-input" id="in_uso" name="in_uso" {% if produzione['in_uso'] %}checked{% endif %}>
            <label class="form-check-label" for="in_uso">In Uso</label>
        </div>
        <div class="form-check">
            <input type="checkbox" class="form-check-input" id="usato" name="usato" {% if produzione['usato'] %}checked{% endif %}>
            <label class="form-check-label" for="usato">Usato</label>
        </div>
        <hr class="my-4">

        <!-- Dettagli Produzione (Materie Prime Utilizzate) -->
        <div class="form-group">
            <label>Materie Prime Utilizzate</label>
            <div id="dettagli-produzione-container">
                {% for dettaglio in dettagli %}
                <div class="row mb-2">
                    <div class="col-md-6">
                        <input type="hidden" name="materia_id" value="{{ dettaglio['materia_id'] }}">
                        <input type="text" class="form-control" value="{{ dettaglio['nome_materia'] }}" disabled>
                    </div>
                    <div class="col-md-4">
                        <input type="number" step="0.01" class="form-control" name="kg_utilizzati" value="{{ dettaglio['kg_utilizzati'] }}">
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <button type="submit" class="btn btn-primary mt-3">Salva Modifiche</button>
    </form>
{% endblock %}
